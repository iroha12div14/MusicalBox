# これは何ですか
Javaで作られた音楽ゲームです。オルゴールの音を楽しみながら、割り当てられたキーをタイミング良く押しつつ楽曲を演奏します。ワンボタンでも遊べます。（演奏ゲームの見た目がキーなんとかマニなんちゃらっぽいです）

## 何が出来ますか
- オルゴールの音を楽しみながら、演奏ゲームができます。
- テキスト形式の自作のパンチカードを組み、楽曲を追加することができます。

## 演奏ゲームとは
- 音符オブジェクト(以下「ノーツ」)が画面下の赤い線(判定線)に着地したタイミングで、対応するキーを押してください。
  - キー押下時のタイミングが良いと、楽曲の意図された音が鳴ります。タイミングが悪かったり、何もない所でお手付きをしてしまうと、意図しないランダムな音が鳴り、本来の楽曲からかけ離れた演奏になってしまいます。
  - 結線されたノーツ（アルペジオノーツ）は、アルペジオのように細かいリズムでキーを入力します。
- 3種類の演奏パート：メロディ、伴奏、或いはメロディ＆伴奏。自動再生にして、眺める事もできます。
  - メロディパートでは、青や白のノーツに対して、J・L・K の任意のキーを押します。どれを押してもOKです。
  - 伴奏パートでは、黄色や紫のノーツに対して、S・D・F の任意のキーを押します。どれを押してもOKです。
  - メロディ＆伴奏では、上記2パートの演奏ゲームを同時に行います。
- 良いタイミングでキーを押した回数が多いほど、達成率が高くなります。他パートの音のリズムを頼りに、タイミングを合わせることが重要です。

## 導入方法
Releasesのページから MusicalBox_vX.X.X.zip と preview_and_punchcard.zip をダウンロードし、同じディレクトリで2つとも解凍して下さい。

## 起動方法
MusicalBox.exe もしくは start_with_console.bat をダブルクリックで起動します。

### 欲しい人は欲しい機能
- 演奏ゲーム画面で↑↓キーを押すと、ノーツの移動速度を変えられます。
- 演奏ゲーム画面でEnterキーを押すと、強制終了して楽曲選択画面に移動できます。
- (v0.0.2以降) 楽曲選択画面でShiftキーを押すと、オプション設定画面に進みます。
  - 項目：フレームレート、主音量調整、判定のサブ表示の有無
- (v0.0.5以降) 楽曲選択画面でTキーを押すと、今まで取得した実績を確認できます。
- (v0.1.0以降) ファイルをMusicalBox.exe上にドラッグ&ドロップすると自動再生されます。コンソールからの起動も可能であり、以下のコマンドで実行可能です。
  - 演奏モードは 0: 自動再生、 1: メロディ、 2: 伴奏、 3: メロディ&伴奏、 なお省略すると自動再生になります。
  - 絶対パスの場所をファイル名のみで記述するとassets/punchCardディレクトリ内のファイルを参照します。

> MusicalBox.exe (ファイルの絶対パス) [演奏モード: 0~3]

## 楽曲を追加するには
assets/punchCard内のテキストを参照して、見様見真似で作ってみて下さい。丸投げで、すみません。一応シーケンス部分（SEQUENCE#START以降）の文法は
- 1行当たりの時間は指定したテンポの16分音符分で、時系列は下であるほど後。
- '#' から左側は意味なし
- '#' から右側の32文字分を読み取っている。ただし、半角空白 ' ' は読み取っていない。
- '*' や '-' は1文字分としてカウントされている。（それ以外の文字でもOKですが、他の文字と混同しにくいものを推奨します。）
- 左端に近いほど音程が低く、右端に近いほど音程が高い。
  - 32音階で、最低音は4A、最高音は7E
- メロディパートのノーツがO/A/P/N、伴奏パートのノーツがo/a/p/n
  - O/o が通常ノーツ、それ以外はアルペジオノーツ
  - A あるいは a を時刻の基準として、P → A → N (p → a → n) の順で音が鳴る。
    - 間隔は60分の2秒
  - 同じ行内に P と A または A と N (p と a または a と n) の組み合わせがある時に結線される。
    - 単発で置くことも可能ですが、見た目的にあまり推奨しません。
    - 'O'と'A'や'o'と'a'を同じ行内に置くこともできますが、キー入力の仕様上1レーンでの同時2ノーツ処理が出来ない(左側から順に処理される)ので非推奨。
- 同じ行内に同じ文字を複数置いてしまった場合、最も左にあるノーツが優先され、他は配置されない。

という形式になっています。データ中に O や o の文字が並ぶことで、パンチカードのような見た目になる点を意識して作りました。

## 既知の不具合とトラブルシューティング
- （v0.1.0以降）（再現性なし）シーンが切り替わる際に稀にゲームが停止する不具合
  - 原因不明ですが、.batで起動した場合はコンソール上でCtrl+Cを押すと動くみたいです。.exe起動の場合はウインドウを閉じてください。すみません。

- （v0.0.2以降）フレームレート(以下FPS)を下げると細かい入力が入りにくくなる不具合、フレームレートを上げるとアニメーションが鈍重になる不具合
  - ともに仕様です。基本的にはFPS50で動作するようですが、音声環境にオーディオインターフェース機器(以下AIF)を介している場合、FPSを最大で800～900程まで上げる事が出来るようです。いずれの場合も、お使いのPC環境に合わせてフレームレートを設定して下さい。

- （再現性なし）演奏ゲームにて時折キー音が鳴らない不具合(特に熊蜂などのノートの多い楽曲で頻発する)
  - 対症処置的対策はしましたが根本的な原因が分からない状態です。すみません。

- （再現性なし）選曲画面でプレビューがたまに途中から再生される不具合
  - 原因不明です。すみません。

## 制作環境とか
- IDEはIntelliJ IDEA Community版、SDKは"JetBrains Runtime version 17.0.10"、同梱したJREはOpen JDK 22.0.2、exe化はlaunch4jを使用しています。
- キー音源のオルゴールはEDIROL SD-90、効果音は自前で録音したものです。

## これを作った人
ビートマニアが大好きです。
